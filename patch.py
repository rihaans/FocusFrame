from pathlib import Path
path = Path('focusframe/analytics.py')
text = path.read_text()
needle = "        decision_map: Dict[str, str] = {}\nfor rule_id, action in decisions:\n    decision_map[rule_id] = action\n\nfor rule_id, count in decision_counts.most_common():\n    override_count = overrides.get(rule_id, 0)\n    action = decision_map.get(rule_id, \"unknown\")\n    ratio = override_count / count if count else 0.0\n    if override_count == 0:\n        message = \"Stable\"\n    elif ratio >= 0.5:\n        message = \"High overrides; consider revising\"\n    elif ratio >= 0.2:\n        message = \"Moderate overrides\"\n    else:\n        message = \"Some overrides observed\"\n    insights.append(\n        RuleInsight(\n            rule_id=rule_id,\n            action=action,\n            decision_count=count,\n            feedback_overrides=override_count,\n            message=message,\n        )\n    )\nreturn insights\n"
replacement = "        decision_map: Dict[str, str] = {}\n        for rule_id, action in decisions:\n            decision_map[rule_id] = action\n\n        for rule_id, count in decision_counts.most_common():\n            override_count = overrides.get(rule_id, 0)\n            action = decision_map.get(rule_id, \"unknown\")\n            ratio = override_count / count if count else 0.0\n            if override_count == 0:\n                message = \"Stable\"\n            elif ratio >= 0.5:\n                message = \"High overrides; consider revising\"\n            elif ratio >= 0.2:\n                message = \"Moderate overrides\"\n            else:\n                message = \"Some overrides observed\"\n            insights.append(\n                RuleInsight(\n                    rule_id=rule_id,\n                    action=action,\n                    decision_count=count,\n                    feedback_overrides=override_count,\n                    message=message,\n                )\n            )\n        return insights\n"
if needle not in text:
    raise SystemExit('needle not found')
path.write_text(text.replace(needle, replacement))
